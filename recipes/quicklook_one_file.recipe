# This recipe is used to watch a [L0/2D/L1/L2] directory for modified files and 
# then to run the appropriate section of the QLP (L0/2D/L1/L2) to generate standard
# data products.  It must be run in watch mode.
#
# Example:
#    > kpf --watch /data/2D/20230711/ -c configs/quicklook_one_file.cfg -r recipes/quicklook_one_file.recipe

from modules.Utils.string_proc import str_replace
from modules.Utils.string_proc import level_from_kpffile
from modules.Utils.string_proc import date_from_kpffile
from modules.quicklook.src.quick_prim import Quicklook

file_path = context.file_path
level = level_from_kpffile(file_path)
datecode = date_from_kpffile(file_path)
output_dir= '/data/QLP/' + datecode + '/'

if level != None:
    open_file = kpf0_from_fits(file_path, data_type='KPF')
    Quicklook(open_file, '/data/QLP/' + datecode + '/', level)
