# TODO: LFC0, LFCR should be defined in wlc config
# TODO: add kwarg for diagnostic plot loc; think about which plots to save long-term/more granular on/off kwargs
# TODO: make sure wave solution is saved to actual file
# TODO: autocorr of comb lines to probe PSF at this point
# TODO: make output fits extension a cfg param
# TODO: we should only put choices in config 
# TODO: make a database rather than saving individual intermediate files

from modules.wavelength_cal.src.wavelength_cal import WaveCalibrate

L1_file = config.ARGUMENT.input_dir + config.ARGUMENT.obs_prefix + config.ARGUMENT.obs_list[0] + '.fits'
master_file = config.ARGUMENT.master_wls_file + '.fits'

lfc_data = kpf1_from_fits(L1_file, data_type='NEID')

quicklook = False

# use wls from L1 NEID file as master solution
wave_soln = WaveCalibrate(lfc_data, master_file, 'LFCF0', 'LFCFR', quicklook, data_type='NEID')

obsname = config.ARGUMENT.obs_prefix + config.ARGUMENT.obs_list[0]
output_filename = config.ARGUMENT.output_dir + obsname + config.ARGUMENT.lev1_suffix + '_wave' + '.fits'
result = to_fits(wave_soln, output_filename)