from modules.wavelength_cal.src.wavelength_cal import WaveCalibrate

obs_num = 0

obsname = config.ARGUMENT.obs_prefix + config.ARGUMENT.obs_list[obs_num]
obsdate = config.ARGUMENT.obs_prefix[3] + config.ARGUMENT.obs_prefix[4] + config.ARGUMENT.obs_prefix[5] + config.ARGUMENT.obs_prefix[6] + config.ARGUMENT.obs_prefix[7] + config.ARGUMENT.obs_prefix[8] + config.ARGUMENT.obs_prefix[9] + config.ARGUMENT.obs_prefix[10]
L1_file = config.ARGUMENT.input_dir + obsdate + '/' + obsname + '.fits'
master_wls_file = config.ARGUMENT.master_wls_file + '.fits'
master_wls = kpf1_from_fits(master_wls_file, data_type='KPF')['RED_CAL_WAVE']

l1_obj = kpf1_from_fits(L1_file, data_type='KPF')

quicklook = config.ARGUMENT.quicklook

output_exts = config.ARGUMENT.output_ext
orderlet_names = config.ARGUMENT.cal_orderlet_name
save_diagnostics = config.ARGUMENT.save_diagnostics + obsdate + '/' + config.ARGUMENT.obs_list[obs_num] + '/'
output_dir = config.ARGUMENT.output_dir + obsdate + '/'
f0 = config.ARGUMENT.f0_key
fr = config.ARGUMENT.frep_key

wave_soln = WaveCalibrate(
    l1_obj, 'LFC', orderlet_names, True, quicklook, 'KPF', output_exts,
    rough_wls = master_wls, f0_key=f0, frep_key=fr, 
    output_dir = output_dir, save_diagnostics=save_diagnostics, 
)